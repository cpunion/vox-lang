import "std/process" as proc
import "llm" as llm

fn prompt_from_args() -> String {
  let argv: Vec[String] = proc.args();
  if argv.len() < 1 { return ""; }

  let mut out: String = "";
  let mut i: i32 = 0;
  while i < argv.len() {
    if i > 0 { out = out.concat(" "); }
    out = out.concat(argv.get(i));
    i = i + 1;
  }
  return out;
}

fn main() -> i32 {
  let prompt: String = prompt_from_args();
  if prompt == "" {
    print("usage: llmdemo <prompt>\n");
    return 2;
  }

  let client: llm.Client = llm.new("openai:gpt-5-nano");
  if !llm.has_api_key(client) {
    print("missing OPENAI_API_KEY (env or .env)\n");
    return 3;
  }

  let reply: String = llm.complete(client, prompt);
  if llm.response_is_error(reply) {
    print(reply);
    print("\n");
    return 4;
  }

  print(reply);
  print("\n");
  return 0;
}
