import "std/testing" as t
import "manifest" as m

fn test_manifest_parse_deps_path() -> () {
  let src: String = "[package]\nname = \"app\"\n\n[dependencies]\nfoo = { path = \"../foo\" }\n";
  let r: m.ParseResult = m.parse(src);
  t.assert(r.ok);
  t.assert_eq(r.m.pkg_name, "app");
  t.assert_eq(r.m.deps.len(), 1);
  let d: m.Dependency = r.m.deps.get(0);
  t.assert_eq(d.name, "foo");
  t.assert_eq(d.path, "../foo");
  t.assert(d.has_path);
  t.assert(!d.has_version);
}

fn test_manifest_parse_deps_version_string() -> () {
  let src: String = "[package]\nname = \"app\"\n\n[dependencies]\nfoo = \"1.2.3\"\n";
  let r: m.ParseResult = m.parse(src);
  t.assert(r.ok);
  t.assert_eq(r.m.deps.len(), 1);
  let d: m.Dependency = r.m.deps.get(0);
  t.assert_eq(d.name, "foo");
  t.assert(!d.has_path);
  t.assert(d.has_version);
  t.assert_eq(d.version, "1.2.3");
}

fn test_manifest_parse_deps_inline_path_and_version() -> () {
  let src: String = "[package]\nname = \"app\"\n\n[dependencies]\nfoo = { path = \"../foo\", version = \"0.2\" }\n";
  let r: m.ParseResult = m.parse(src);
  t.assert(r.ok);
  t.assert_eq(r.m.deps.len(), 1);
  let d: m.Dependency = r.m.deps.get(0);
  t.assert(d.has_path);
  t.assert_eq(d.path, "../foo");
  t.assert(d.has_version);
  t.assert_eq(d.version, "0.2");
}
