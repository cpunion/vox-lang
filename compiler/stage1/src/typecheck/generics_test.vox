import "std/testing" as t
import "parse" as p
import "typecheck" as tc

fn add_mod2(w: tc.World, path: String, src: String) -> tc.World {
  let r: p.ParseResult = p.parse_text(src);
  t.assert(r.err == p.ParseError.None);
  return tc.world_add(w, path, r.prog);
}

fn test_typecheck_allows_generic_fn_sig() -> () {
  let mut w: tc.World = tc.world();
  w = add_mod2(w, "main", "fn id[T](x: T) -> T { return x; }\nfn main() -> i32 { return 0; }");
  let r: tc.TcResult = tc.typecheck_world(w);
  t.assert(r.ok);
}

fn test_typecheck_generic_call_infers_vec_return() -> () {
  let mut w: tc.World = tc.world();
  w = add_mod2(w, "main", "fn mk[T](x: T) -> Vec[T] { return Vec(); }\nfn main() -> i32 { let v = mk(1); return v.len(); }");
  let r: tc.TcResult = tc.typecheck_world(w);
  t.assert(r.ok);
}
