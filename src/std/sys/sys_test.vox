import "std/sys" as sys
import "std/testing" as t

fn test_sys_rawptr_read_smoke() -> () {
  let p: rawptr = sys.calloc(1 as usize, 1 as usize);
  let nr: isize = sys.read(0, p, 0 as usize);
  sys.free(p);
  t.assert(nr >= 0 || nr < 0);
}

fn test_sys_const_rawptr_write_smoke() -> () {
  let nw: isize = sys.write(1, "" as const rawptr, 0 as usize);
  t.assert_eq(nw, 0 as isize);
}

fn test_sys_open_read_missing_path_smoke() -> () {
  let fd: i32 = sys.open_read("__vox_missing_path_should_not_exist__.tmp");
  if fd >= 0 {
    let _rc: i32 = sys.close(fd);
  }
  t.assert(fd >= 0 || fd < 0);
}

fn test_sys_open_read_existing_path_smoke() -> () {
  let path: String = "target_sys_open_read_smoke.tmp";
  let fdw: i32 = sys.creat(path, 384);
  t.assert_with(fdw >= 0, "expected creat success");
  if fdw >= 0 {
    let nw: isize = sys.write(fdw, "ok" as const rawptr, 2 as usize);
    t.assert_with(nw >= 0, "expected write success");
    let _c0: i32 = sys.close(fdw);
  }

  let fdr: i32 = sys.open_read(path);
  t.assert_with(fdr >= 0, "expected open_read success");
  if fdr >= 0 {
    let _c1: i32 = sys.close(fdr);
  }
}

fn test_sys_system_smoke() -> () {
  let rc: i32 = sys.system("");
  t.assert(rc >= 0 || rc < 0);
}
