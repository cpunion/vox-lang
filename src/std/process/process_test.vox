import "std/process" as proc
import "std/string" as s
import "std/testing" as t

fn test_process_command_render_smoke() -> () {
  let c: proc.Command = proc.command("vox")
    .env("A", "1 2")
    .arg("hello world")
    .arg("\"x\"");
  let r: String = c.render();
  t.assert(s.contains(s.view_all(r), "A=\"1 2\""));
  t.assert(s.contains(s.view_all(r), "\"vox\""));
  t.assert(s.contains(s.view_all(r), "\"hello world\""));
  t.assert(s.contains(s.view_all(r), "\\\"x\\\""));
}

fn test_process_command_run_smoke() -> () {
  let exe: String = proc.exe_path();
  if exe == "" { return; }
  if s.contains(s.view_all(exe), "vox.test") { return; }
  let cmd: proc.Command = proc.command(exe).arg("version");
  let rc: i32 = cmd.run();
  t.assert_eq(rc, 0);
}

fn test_process_exec_compat_with_command_render_smoke() -> () {
  let exe: String = proc.exe_path();
  if exe == "" { return; }
  if s.contains(s.view_all(exe), "vox.test") { return; }
  let cmd: proc.Command = proc.command(exe).arg("version");
  let cmdline: String = cmd.render();
  let rc: i32 = proc.exec(cmdline);
  t.assert_eq(rc, 0);
}
