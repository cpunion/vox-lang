import "std/io" as io
import "std/testing" as t
import "std/time" as tm

fn tmp_file_path(prefix: String) -> String {
  io.mkdir_p("target/tmp");
  return "target/tmp/"
    .concat(prefix)
    .concat("_")
    .concat(tm.now_ns().to_string())
    .concat(".txt");
}

fn test_io_file_oop_api_smoke() -> () {
  let path: String = tmp_file_path("io_oop");
  let f: io.File = io.file(path);
  f.write_all("hello");
  t.assert(f.exists());
  t.assert_eq(f.read_all(), "hello");
}

fn test_io_file_free_function_compat_smoke() -> () {
  let path: String = tmp_file_path("io_compat");
  let f_write: io.File = io.file(path);
  f_write.write_all("x");
  t.assert(io.file_exists(path));
  let f_read: io.File = io.file(path);
  t.assert_eq(f_read.read_all(), "x");
  let dir: io.File = io.file(path.concat(".dir"));
  dir.mkdir_p();
}

fn test_io_buffer_helpers_smoke() -> () {
  let br: io.BufReader = io.buf_reader(0);
  t.assert_eq(br.capacity(), 1);
  t.assert_eq(br.buffered(), 0);

  let bw: io.BufWriter = io.buf_writer(16);
  t.assert_eq(bw.capacity(), 16);
  t.assert_eq(bw.buffered(), 0);
}
