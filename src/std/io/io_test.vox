import "std/io" as io
import "std/runtime" as rt
import "std/testing" as t

fn tmp_file_path(prefix: String) -> String {
  io.mkdir_p("target/tmp");
  return "target/tmp/"
    .concat(prefix)
    .concat("_")
    .concat(rt.now_ns().to_string())
    .concat(".txt");
}

fn test_io_file_oop_api_smoke() -> () {
  let path: String = tmp_file_path("io_oop");
  let f: io.File = io.file(path);
  f.write_all("hello");
  t.assert(f.exists());
  t.assert_eq(f.read_all(), "hello");
}

fn test_io_file_free_function_compat_smoke() -> () {
  let path: String = tmp_file_path("io_compat");
  let f: io.File = io.file(path);
  io.file_write_all(f, "x");
  t.assert(io.file_exists(path));
  t.assert_eq(io.file_read_all(f), "x");
  let dir: io.File = io.file(path.concat(".dir"));
  dir.mkdir_p();
}
