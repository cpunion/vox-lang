import "std/runtime" as rt
import "std/sync" as s
import "std/testing" as t

fn test_runtime_intrinsic_abi_and_intrinsic_probe_smoke() -> () {
  t.assert(rt.intrinsic_abi() >= 1);
  t.assert(!rt.has_intrinsic("__read_file"));
  t.assert(!rt.has_intrinsic("__wake_wait_any"));
  t.assert(!rt.has_intrinsic("not_real_intrinsic"));
}

fn test_runtime_wake_wait_any_smoke() -> () {
  let mut toks: Vec[i64] = Vec();
  toks.push(101 as i64);
  toks.push(102 as i64);
  t.assert_eq(rt.wake_wait_any(toks, 0), -1);
  rt.wake_notify(102 as i64);
  t.assert_eq(rt.wake_wait_any(toks, 1), 1);
}

fn test_runtime_mutex_via_sync_smoke() -> () {
  let m: s.Mutex[i32] = s.mutex[i32](1);
  t.assert_eq(s.mutex_load[i32](m), 1);
  let m2: s.Mutex[i32] = s.mutex_store[i32](m, 3);
  t.assert_eq(s.mutex_load[i32](m2), 3);
  s.mutex_drop[i32](m);
}
