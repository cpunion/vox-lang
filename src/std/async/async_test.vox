import "std/testing" as t
import "std/async" as a

struct TestRuntime {
  n: i32,
}

impl a.Runtime for TestRuntime {
  fn pending_wait(rt: TestRuntime, i: i32, c: a.Context) -> () {
    rt;
    i;
    c;
    return;
  }
}

fn test_std_async_poll_helpers_smoke() -> () {
  let p0: a.Poll[i32] = a.Poll.Pending;
  let p1: a.Poll[i32] = a.Poll.Ready(7);
  t.assert(a.is_pending(p0));
  t.assert(!a.is_ready(p0));
  t.assert(a.is_ready(p1));
  t.assert(!a.is_pending(p1));
}

fn test_std_async_context_waker_smoke() -> () {
  let w: a.Waker = a.waker(11);
  let cx: a.Context = a.context(w);
  t.assert_eq(cx.waker.token, 11);
}

fn test_std_async_spin_wait_smoke() -> () {
  a.spin_wait(0);
  a.spin_wait(7);
}

fn test_std_async_pending_wait_smoke() -> () {
  let w: a.Waker = a.waker(3);
  let cx: a.Context = a.context(w);
  a.pending_wait(0, cx);
  a.pending_wait(5, cx);
}

fn test_std_async_wake_park_smoke() -> () {
  let w: a.Waker = a.waker(7);
  let cx: a.Context = a.context(w);
  a.wake(cx);
  a.park(0, cx);
  a.park(4, cx);
}

fn test_std_async_runtime_trait_smoke() -> () {
  let w: a.Waker = a.waker(9);
  let cx: a.Context = a.context(w);
  a.pending_wait_with(TestRuntime { n: 1 }, 3, cx);
  a.park_with(TestRuntime { n: 1 }, 3, cx);
  a.pending_wait_with(a.spin_runtime(), 0, cx);
  a.park_with(a.spin_runtime(), 0, cx);
}
