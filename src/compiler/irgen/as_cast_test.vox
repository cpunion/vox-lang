import "std/testing" as t
import "compiler/typecheck" as tc
import "compiler/irgen" as g
import "compiler/ir" as ir

fn test_irgen_as_i32_to_i64_emits_cast_instr() -> () {
  let mut w: tc.World = tc.world();
  w = add_mod(w, "main", "fn main(x: i32) -> i64 { return x as i64; }");
  let r: g.GenResult = g.generate_world(w);
  t.assert(r.ok);
  let s: String = ir.format_program(r.prog);
  t.assert(contains(s, " = int_cast_checked i64 i32 "));
}

fn test_irgen_as_i64_to_i32_checked_emits_cast_instr() -> () {
  let mut w: tc.World = tc.world();
  w = add_mod(w, "main", "fn main(x: i64) -> i32 { return x as i32; }");
  let r: g.GenResult = g.generate_world(w);
  t.assert(r.ok);
  let s: String = ir.format_program(r.prog);
  t.assert(contains(s, " = int_cast_checked i32 i64 "));
}
