import "std/testing" as t

fn test_cli_target_parse_windows_mingw_triple_smoke() -> () {
  let tr: CliTargetSpec = parse_cli_target_spec("x86_64-w64-mingw32", "darwin", "arm64");
  t.assert(tr.ok);
  t.assert(tr.os == "windows");
  t.assert(tr.arch == "amd64");
  t.assert(tr.abi == "gnu");
  t.assert(tr.triple == "x86_64-w64-mingw32");
}

fn test_cli_target_parse_windows_msvc_triple_smoke() -> () {
  let tr: CliTargetSpec = parse_cli_target_spec("x86_64-pc-windows-msvc", "darwin", "arm64");
  t.assert(tr.ok);
  t.assert(tr.os == "windows");
  t.assert(tr.arch == "amd64");
  t.assert(tr.abi == "msvc");
  t.assert(tr.triple == "x86_64-pc-windows-msvc");
}

fn test_cc_cmdline_windows_msvc_smoke() -> () {
  let cmd: String = cc_cmdline_for_target("windows", "amd64", "windows", "amd64", "x86_64-pc-windows-msvc", "msvc", "out.c", "out.exe");
  t.assert(text_contains(cmd, " /TC "));
  t.assert(text_contains(cmd, " /Fe:out.exe"));
  t.assert(text_contains(cmd, "ws2_32.lib"));
}

fn test_cc_cmdline_windows_mingw_smoke() -> () {
  let cmd: String = cc_cmdline_for_target("linux", "amd64", "windows", "amd64", "x86_64-w64-mingw32", "gnu", "out.c", "out.exe");
  t.assert(text_contains(cmd, "x86_64-w64-mingw32-gcc"));
  t.assert(text_contains(cmd, " -lws2_32"));
}
