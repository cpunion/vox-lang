import "std/testing" as t
import "vox/ir" as ir

fn test_ty_pool_add_and_get() -> () {
  let mut p: ir.TyPool = ir.ty_pool();

  let r1: ir.AddTyResult = ir.ty_pool_add(p, ir.ty_unit());
  p = r1.pool;
  let idx1: i32 = r1.idx;
  let ty1: ir.Ty = ir.ty_pool_get(p, idx1);

  let ok1: bool = match ty1.kind {
    ir.TyKind.Unit => true,
    _ => false,
  };
  t.assert(ok1);

  let r2: ir.AddTyResult = ir.ty_pool_add(p, ir.ty_vec(idx1));
  p = r2.pool;
  let idx2: i32 = r2.idx;
  let ty2: ir.Ty = ir.ty_pool_get(p, idx2);

  let ok2: bool = match ty2.kind {
    ir.TyKind.Vec => true,
    _ => false,
  };
  t.assert(ok2);
  t.assert_eq(ty2.elem, idx1);
}
