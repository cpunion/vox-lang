import "std/testing" as t
import "vox/compile" as c
import "vox/loader" as ld
import "vox/codegen" as cg

fn test_compile_files_to_c_profile_smoke() -> () {
  let mut fs: Vec[ld.SourceFile] = Vec();
  fs.push(ld.SourceFile { path: "src/main.vox", text: "fn main() -> i32 { return 0; }" });

  let pr: c.CompileProfileResult =
    c.compile_files_to_c_profile(
      fs,
      cg.EmitOptions { emit_driver_main: true, driver_main_kind: cg.DriverMainKind.User, emit_test_main: false, test_funcs: Vec() },
    );
  t.assert(pr.r.ok);
  t.assert(pr.p.load_ns >= 0);
  t.assert(pr.p.macroexpand_ns >= 0);
  t.assert(pr.p.rewrite_async_ns >= 0);
  t.assert(pr.p.typecheck_ns >= 0);
  t.assert(pr.p.irgen_ns >= 0);
  t.assert(pr.p.ir_verify_ns >= 0);
  t.assert(pr.p.codegen_ns >= 0);
}
