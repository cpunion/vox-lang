import "std/testing" as t
import "vox/fmt" as fmt

fn test_fmt_indent_and_blank_lines_smoke() -> () {
  let src: String =
  "fn main()->i32 {\n"
  .concat("let x:i32=1;    \n")
  .concat("\n")
  .concat("\n")
  .concat("if x>0 {\n")
  .concat("return x;\n")
  .concat("}\n")
  .concat("}\n");
  let got: String = fmt.format_text(src);
  let want: String =
  "fn main()->i32 {\n"
  .concat("  let x:i32=1;\n")
  .concat("\n")
  .concat("  if x>0 {\n")
  .concat("    return x;\n")
  .concat("  }\n")
  .concat("}\n");
  t.assert_eq(got, want);
}

fn test_fmt_preserve_triple_string_smoke() -> () {
  let src: String =
  "fn main() -> () {\n"
  .concat("let s: String = \"\"\"\n")
  .concat("{ keep } // not comment\n")
  .concat("\"\"\";\n")
  .concat("if true {\n")
  .concat("return;\n")
  .concat("}\n")
  .concat("}\n");
  let got: String = fmt.format_text(src);
  let want: String =
  "fn main() -> () {\n"
  .concat("  let s: String = \"\"\"\n")
  .concat("{ keep } // not comment\n")
  .concat("\"\"\";\n")
  .concat("  if true {\n")
  .concat("    return;\n")
  .concat("  }\n")
  .concat("}\n");
  t.assert_eq(got, want);
}

fn test_fmt_discover_files_file_and_dir_smoke() -> () {
  let mut paths: Vec[String] = Vec();
  paths.push("src/main.vox");
  paths.push("src/vox/fmt");
  let files: Vec[String] = fmt.discover_files(paths);
  t.assert(files.len() > 0);
}
