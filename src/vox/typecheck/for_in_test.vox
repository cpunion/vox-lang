import "std/testing" as t
import "vox/typecheck" as tc

fn typecheck_main_text(src: String) -> tc.TcResult {
  let mut w: tc.World = tc.world();
  w = add_mod(w, "main", src);
  return tc.typecheck_world(w);
}

fn test_typecheck_for_in_vec_smoke() -> () {
  let r: tc.TcResult = typecheck_main_text("""
    fn main() -> i32 {
      let mut xs: Vec[i32] = Vec();
      xs.push(1);
      xs.push(2);
      xs.push(3);
      let mut s: i32 = 0;
      for x in xs {
        s = s + x;
      }
      return s;
    }
  """);
  t.assert_with(ok(r), tc.tc_error_to_string(r.err));
}

fn test_typecheck_for_in_non_iterable_rejected() -> () {
  let r: tc.TcResult = typecheck_main_text("""
    fn main() -> i32 {
      let x: i32 = 7;
      for v in x {
        let _k: i32 = v;
      }
      return 0;
    }
  """);
  t.assert_with(!ok(r), "for-in over non-iterable should be rejected");
}
