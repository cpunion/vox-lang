fn test_syntax_async_and_await_forms() -> () {
  // SYNTAX:S501 async function syntax
  // SYNTAX:S502 postfix await syntax
  // SYNTAX:S503 await inside if/match expressions
  // SYNTAX:S504 async trait method syntax
  let src: String = """
trait Work { async fn run(x: Self) -> i32; }
struct F { v: i32 }
impl Work for F { async fn run(x: F) -> i32 { return x.v; } }
async fn get() -> i32 { return 1; }
async fn main() -> i32 {
  let x: i32 = get().await;
  let _w: i32 = await get();
  let y: i32 = if x > 0 { get().await } else { 0 };
  let z: i32 = match y { 0 => 0, _ => get().await };
  return z + Work.run(F { v: 2 }).await;
}
""";
  syntax_assert_parse_ok("S501-S504", src);
}

fn test_syntax_broken_await_expr_fails() -> () {
  // SYNTAX:S505 malformed await expression should fail parse
  syntax_assert_parse_fail("S505", "async fn main() -> i32 { let x: i32 = .await; return x; }");
}
